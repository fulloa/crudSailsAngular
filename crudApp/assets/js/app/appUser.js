// Generated by CoffeeScript 1.10.0
(function() {
  var User, app;

  User = (function() {
    function User($scope, Upload) {
      $scope.users = [];
      $scope.newUser = {
        name: "",
        lastName: "",
        email: "",
        birthdate: new Date(),
        user: "",
        pass: "",
        image: "/images/user.png"
      };
      $scope.createUser = function(user) {
        if ($scope.userForm.$valid) {
          return io.socket.get("/user/create/", user, function(data) {
            console.log("Agregando datos");
            console.log(data);
            $scope.users.push(data);
            $scope.newUser = {
              name: "",
              lastName: "",
              email: "",
              birthdate: new Date(),
              user: "",
              pass: ""
            };
            return $scope.$apply();
          });
        }
      };
      $scope.updateUser = function(user) {
        var userUpdate;
        console.log("Actualizando");
        userUpdate = angular.extend({}, user);
        return io.socket.get("/user/update/" + user.id, user, function(data) {
          console.log("Datos modificados correctamente");
          return console.log(data);
        });
      };
      $scope.deleteUser = function(user) {
        console.log("eliminando");
        return io.socket.get("/user/destroy/" + user.id, user, function(data) {
          var index;
          index = $scope.users.indexOf(user);
          $scope.users.splice(index, 1);
          $scope.$apply();
          console.log("Eliminando datos");
          return console.log(data);
        });
      };
      $scope.upload = function(file, invalidFiles) {
        console.log(file);
        console.log(invalidFiles);
        console.log($scope.curUser.id);
        if (file) {
          return Upload.upload({
            url: '/user/upload',
            data: {
              file: file,
              id: $scope.curUser.id
            }
          }).then(function(response) {
            $scope.curUser.image = response.data.img;
            return true;
          }, function(response) {
            console.log(response);
            if (response.status > 0) {
              return $scope.errorMsg = response.status + " : " + response.data;
            }
          }, function(evt) {
            console.log(evt);
            return $scope.progress = parseInt(100.0 * evt.loaded / evt.total);
          });
        }
      };
      $scope.showLoadImage = function(user) {
        $scope.curUser = user;
        $("#loadImageModal").modal("show");
        return true;
      };
      io.socket.get('/user/', {}, function(data) {
        $scope.users = data;
        $scope.$apply();
        return console.log(data);
      });
    }

    return User;

  })();

  app = angular.module('Users', ['ui.bootstrap', 'ui.bootstrap.showErrors', 'ngFileUpload']);

  app.controller('userController', ['$scope', 'Upload', User]);

}).call(this);
